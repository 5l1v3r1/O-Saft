#!/bin/sh
#?
#? NAME
#?      o-saft_bench  - simple time and memory test program for o-saft.pl
#?

SID="@(#) o-saft_bench 1.2 14/07/27 22:12:13"

yeast=o-saft.pl
 host=localhost
 time=/usr/bin/time
  out=./o-saft_time-tests
  cnt=4   # additional 4 lines which are the table header and footer line

(echo
 echo -n "# " && date
 echo -n "# o-saft.pl +VERSION: " && $yeast +VERSION --norc
 echo -n "# System (uname -a):  " && uname -a
 echo -n "# Perl   (perl -v):   " && perl -v|grep This
 echo    "#"
) | tee -a $out
echo -n "# prepare ... "
$yeast +check localhost --trace --user >/dev/null 2>&1 # dummy to load modules and alocate memory
echo "done."
t="%U  %S  %E  %P  %Kk  %Mk"
line="#--------------------------------------+-----+------+-------+----+----+--------"
(
echo "#                                      |       time         |    |  memory    |"
echo "#         command                      | user system    real| CPU| av.  max   |"
echo $line
) >> $out
while read -r cmd ; do
	[ -z "$cmd" ] && continue  # skip final emtpy line
	echo -n "o-saft.pl $cmd " | tee -a $out && $time --quiet -o $out -a -f "$t" $yeast $cmd >/dev/null && echo ""
        cnt=`expr $cnt + 1`
done << EoT
	+VERSION           --norc    \ 
	+version                     \ 
	+version --v --usr           \ 
	+version           --norc    \ 
	+version --v       --norc    \ 
	+libversion                  \ 
	+libversion        --norc    \ 
	+ciphers                     \ 
	+ciphers -V                  \ 
	+list                        \ 
	--v +help                    \ 
	+gen-wiki                    \ 
	+gen-wiki    --usr           \ 
	+cipher            $host \ 
	+cipherall         localhost \ 
	+info              localhost \ 
	+info  --noopenssl localhost \ 
	+quick             localhost \ 
	+quick --noopenssl localhost \ 
	+check             localhost \ 
	+check --noopenssl localhost \ 

EoT
# tricky here document:
# We want to have well formated texts (command and options) for o-saft.pl call.
# Hence we use a trailing backslash followed by a single space.

echo $line  >> $out
tail -$cnt $out
exit

