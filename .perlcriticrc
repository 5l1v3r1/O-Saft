#! /usr/bin/perlcritic
#?
#? NAME
#?      .perlcriticrc  - configuration for Perl::Critic for O-Saft
#?
#? SYNOPSIS
#?      perlcritic <filenames> ...
#?
#? DESCRIPTION
#?      This file contains the configuration for  Perl::Critic,  perlcritic.
#?      The settings are explained, why they are ENABLED or DISABLED.
#?
#?       ###################################################################
#?       FIXME: this file is a first attempt, not yet completed.
#?       ###################################################################
#?
#? EXAMPLES
#?      # the usual way
#?          perlcritic <filenames>
#?
#?      # print policy for each message
#?          perlcritic <filenames> --verbose 8
#?
#?      # print full description for each message
#?          perlcritic <filenames> --verbose 10
#?
#?      # check for a single policy (Subroutines::RequireFinalReturn)
#?          perlcritic <filenames> --single-policy  Subroutines::RequireFinalReturn
#?          perlcritic <filenames> --only --include Subroutines::RequireFinalReturn
#?
#?      # just get a statistic for severity 4 and 5
#?          perlcritic <filenames> --severity 4 --statistics-only
#?
#?      # get a a quick overview for violations of severity 4 and 5
#?          perlcritic *.pl *.pm --severity 4 --count
#?
#? LIMITATIONS
#?      Do not use perlcritic with an directory as parameter in the development
#?      directory as there are  too much matching files (i.e. SCCS/*) which may
#?      cause problems. Use list of files instead:   *.pl *.pm Net/*.pm
#?
#? VERSION
#?      @(#) .perlcriticrc 1.1 16/04/07 10:23:22
#
#? AUTHOR
#?      06-apr-16 Achim Hoffmann
#?
# -----------------------------------------------------------------------------

# global options
severity    = 5
    # will change to 4 o 3 later

verbose     = 8
    # always want to see the policy name

#program-extensions '.pl .pm'
    # does not work as described by perlcritic :-/

[ControlStructures::ProhibitPostfixControls]
    allow   = if unless
    #allow  = foreach
	# as the severity is already 2, its okay to report foreach violations

    # Message:
	# Postfix control "if" used at line ...

    # CHECK adapted
	# Postfix controls are used often to have the relevant code far left!


[InputOutput::RequireCheckedClose]
    severity = 1

    # Message:
	# Return value of "close" ignored at line ...

    # CHECK DISABLED
	# For our purpose it's nice if the files is closed, but not necessary.
	# hence severity reduced to 1


[InputOutput::ProhibitBacktickOperators]
    only_in_void_context = 1

    # Message:
	# Backtick operator used at line ...

    # CHECK ENABLED
	# Literal backticks are not used, but the qx() operator. Backticks are
	# used in void context, hence the restriction to only_in_void_context.


[InputOutput::ProhibitBarewordFileHandles]
[InputOutput::ProhibitTwoArgOpen]

    # Messages:
	# Bareword file handle opened at line ...
	# Two-argument "open" used at line ...

	# A bareword is a series of characters (like the FH) without quotes
	# around them, or without a sigil in-front of them. They can be used in
	# some places, but in file-handles they are not recommended any more.

    # Recommendation
	# Always use lexical variables and always use 3-parameter for open. 


[-InputOutput::ProhibitExplicitStdin]

    # Message:
	# Use "<>" or "<ARGV>" or a prompting module instead of "<STDIN>" at line ...

    # CHECK DISABLED
	# The reason why  "*ARGV behaves like *STDIN"  is described as
	# "is almost always what you want"  sounds strange.
	# In our usage this is never the case, because we also may get data on
	# STDIN and have command line arguments.


#[InputOutput::ProhibitInteractiveTest]
#[InputOutput::ProhibitJoinedReadline]
#[InputOutput::ProhibitOneArgSelect]
#[InputOutput::ProhibitReadlineInForLoop]
#[InputOutput::RequireBracedFileHandleWithPrint]


[InputOutput::RequireBriefOpen]
    lines    = 15
    severity = 2

    # Message:
	# Close filehandles as soon as possible after opening them at line ...

    # CHECK adapted
	# Because we have more code until close, sometimes.
	# TODO: lines= seems not to work as descibed, produces false positives
	#         therefore serverity is reduced


#[InputOutput::RequireCheckedOpen]
#[InputOutput::RequireCheckedSyscalls]
#[InputOutput::RequireEncodingWithUTF8Layer]


[-RegularExpressions::RequireDotMatchAnything]

    # Message:
	# Regular expression without "/s" flag at line ...

    # CHECK DISABLED
	# cause we know about meta character . and /s modifier in RegEx ;-)


[-RegularExpressions::RequireLineBoundaryMatching]

    # Message:
	# Regular expression without "/m" flag at line ...

    # CHECK DISABLED
	# cause we use /m as needed


[-RegularExpressions::RequireExtendedFormatting]

    # Message:
	# Regular expression without "/x" flag at line ...

    # CHECK DISABLED
	# cause we use /x as needed for human readability


[-Subroutines::ProhibitSubroutinePrototypes]

    # Message:
	# Subroutine prototypes used at line ...

    # CHECK DISABLED
	# Contrary to Perl::Critic we consider prototypes as useful, even if
	# perls compile-time checks are not perfect, perl may give some hints.


#[-Subroutines::RequireFinalReturn]

	# FIXME:


[-CodeLayout::RequireTidyCode]

    # Message:
	# Code is not tidy at line 1, column 1.

    # CHECK DISABLED
	# TODO: tidy not yet used


[-CodeLayout::ProhibitParensWithBuiltins]

    # Message:
	# Builtin function called with parentheses at line ...

    # CHECK DISABLED
	# Contrary to BPB we think that all functions should use parentheses.
	# Continous use of parentheses makes thir-party parsers happy.
	# However: we miss parentheses, mainly for print builtin function.


[-CodeLayout::RequireTidyCode]

    # Message:
	# Code is not tidy at line 1, column 1.

    # CHECK DISABLED
	# TODO: tidy not yet used


[CodeLayout::ProhibitHardTabs]

    # CHECK ENABLED
	# thera are leading tabs only, usually


[CodeLayout::ProhibitTrailingWhitespace]

    # Message:
	# Found "\N{SPACE}" at the end of the line ...

    # CHECK ENABLED
	# We hate unecessary characters too ;-)


[CodeLayout::RequireConsistentNewlines]

    # CHECK ENABLED


[Variables::ProhibitPunctuationVars]
    allow = $@ $! $? $0 $. $^O $\

	# we make regular use of these variables as we know them;-)


[Variables::RequireLocalizedPunctuationVars]
    allow   = @ENV

    # Message:
	# Magic variable "$ENV" should be assigned as "local"

    # CHECK adapted
	# @ENV must be changed globally (at least in o-saft.pl)
	# TODO: need to verify if @INC should be allowed too
	# percritic seems to be buggy as it does not honor the allow option


[-ValuesAndExpressions::ProhibitEmptyQuotes]

    # Message:
	# Quotes used with a string containing no non-whitespace characters at line ...

    # CHECK DISABLED
	# cause we consider following correct and useful:  my $var = '';
	# the recomended use of q{} looks too complex:     my $var = q{};


[ValuesAndExpressions::ProhibitEscapedCharacters]

    # Message:
	# Numeric escapes in interpolated string at line ...

    # CHECK ENABLED


#[ValuesAndExpressions::ProhibitConstantPragma]

	# FIXME: to be discussed


#[ValuesAndExpressions::ProhibitMagicNumbers]

	# FIXME: to be discussed
	# Workaround: disable selectively where appropriate with:
		## no critic qw(ValuesAndExpressions::ProhibitMagicNumbers)


    # Message:
	# "grep" used in void context at line  ...


#[TestingAndDebugging::ProhibitNoStrict]

    # Message:
	# Stricture disabled at line 

	# FIXME: to be discussed
	# i.g. we want this warning, but strict is also disabled in the code
	# for good reason, probably use
		## no critic qw(TestingAndDebugging::ProhibitNoStrict)


[TestingAndDebugging::ProhibitNoWarnings]
    severity = 3

    # Message:
	# Warnings disabled at line

	# FIXME: to be discussed; for now severity reduced to 3
	# i.g. we want this warning, but some warnings are also disabled in
	# the code for good reason, probably use
		## no critic qw(TestingAndDebugging::ProhibitNoWarnings)


#[BuiltinFunctions::ProhibitStringyEval]

    # Message:
	# Expression form of "eval" at line 3117

	# FIXME: to be discussed
	# This occour for  eval("require ..."), so probably use
		## no critic qw(BuiltinFunctions::ProhibitStringyEval)
